<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>populate-oauth-secrets.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/oauth.html">oauth</a></li>
            
                <li><a href="../classes/requestHandler.html">requestHandler</a></li>
            
                <li><a href="../classes/responseHandler.html">responseHandler</a></li>
            
                <li><a href="../classes/server.html">server</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/del.html">del</a></li>
            
                <li><a href="../modules/deleteAll.html">deleteAll</a></li>
            
                <li><a href="../modules/errcode.html">errcode</a></li>
            
                <li><a href="../modules/get.html">get</a></li>
            
                <li><a href="../modules/index.js.html">index.js</a></li>
            
                <li><a href="../modules/insert.js.html">insert.js</a></li>
            
                <li><a href="../modules/load-oauth-secrets.html">load-oauth-secrets</a></li>
            
                <li><a href="../modules/populate-oauth-secrets.html">populate-oauth-secrets</a></li>
            
                <li><a href="../modules/queryValidation.html">queryValidation</a></li>
            
                <li><a href="../modules/router.html">router</a></li>
            
                <li><a href="../modules/update.html">update</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: populate-oauth-secrets.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
Loads OAuth consumer keys and secrets into MongoDB.
They will be loaded into the collection specified as the oauth_collection in the mongodb.json config file.
This will REPLACE all oauth secrets in Mongo.
The oauth secrets are loaded from the file config/oauth-secrets.json .  After this script is executed, the oauth secrets in this file will
be the ONLY oauth secrets stored in Mongo.

To run, put all of the keys that you want in the db into the config file mentioned above and run:
$ node populate-oauth-secrets.js

@module populate-oauth-secrets
**/
var config = require(&#x27;konphyg&#x27;)(__dirname + &#x27;/../config&#x27;);
var mongoConfig = config(&#x27;mongodb&#x27;);
var MongoClient = require(&#x27;mongodb&#x27;).MongoClient;

//load oauth secrets file
var oauth_secrets = require(&#x27;../config/oauth-secrets.json&#x27;);

var uri = mongoConfig.uri;

MongoClient.connect(uri, function(err, db) {
	if(err){
		console.log(err);
	} else {
		db.collection(mongoConfig.oauth_collection, function(err, collection){
			
			//remove all old oauth secrets.
			collection.remove({}, function(err, result){
				if(err){
					console.log(&#x27;Error deleting old secrets&#x27; + err);
					process.exit(1);
				}
			});
			collection.insert(oauth_secrets, {w:1}, function(err, result) {
				if(err){
					console.log(&#x27;error inserting&#x27; + err);
				} else {
					console.log(&#x27;Oauth secrets successfully populated&#x27;);
				}
			
				db.close();
			});
		});
	}

});



    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
